# Лабораторная №2 

## Задание (обычная)

1. Написать "плохой” Dockerfile, в котором есть не менее трех “bad practices” по написанию докерфайлов.
2. Написать “хороший” Dockerfile, в котором эти плохие практики исправлены.
3. В Readme описать каждую из плохих практик в плохом докерфайле, почему она плохая и как в хорошем она была исправлена, как исправление повлияло на результат.
4. В Readme описать 2 плохих практики по работе с контейнерами. ! Не по написанию докерфайлов, а о том, как даже используя хороший докерфайл можно накосячить именно в работе с контейнерами.


## Ход работы
### 1. Напишем "плохой” Dockerfile, в котором есть не менее трех “bad practices” по написанию докерфайлов.

```
FROM python:latest


RUN apt-get update && apt-get install -y \
    build-essential \
    && pip install flask

COPY . /app

WORKDIR /app

CMD ["python", "app.py"]
```
Рассмотрим каждую ошибку по отдельности:
1. Использование тега `latest` делает сборку непредсказуемой, так как каждая новая версия образа может сломать совместимость приложения.
2. Отсутствует очистка кэша `APT`. Когда кэш не отчищается, образ контейнера становится больше, что влияет на время загрузки и количество выделенных ресурсов.
Очищение кэша с помощью команды `rm -rf /var/lib/apt/lists/*` после установки пакетов:
- Уменьшает итоговый размер образа, что ускоряет его передачу и запуск.
- Избавляется от ненужных временных файлов и улучшает безопасность.
- Делает контейнеры более эффективными в плане использования ресурсов
3. Команда `COPY . /app`. Нельзя копировать все файлы проекта (всю директорию) в докер образ, это приведет к ненужному увеличению размера докер файла и проблемам с безопасностью, т.к. среди них могут оказаться конфиденциальные данные.
### 2. Напишем “хороший” Dockerfile, в котором эти плохие практики исправлены.
```
FROM python:3.9


RUN apt-get update && apt-get install -y build-essential \
	&& rm -rf /var/lib/apt/lists/* \	
    && pip install flask

COPY app.py /app/app.py

WORKDIR /app

CMD ["python", "app.py"]
```
Что стало лучше:
1. Тег `latest` измнен на `3.9`. Это поможет нам избежать ошибок при сборке, потому что версия python меняется очень быстро. Сейчас это `3.12.7`. Несмотря на это, мы сможем собрать образ с нужной версией (вчера, сегодня, завтра), что обеспечит его стабильность.
   
<b>Результат:</b> Более стабильный и воспроизводимый процесс сборки.

Состояние версий на 02.10.2024

![Versions](img/versions.png)

2) В хорошем Dockerfile используется команда rm -rf /var/lib/apt/lists/*, которая удаляет ненужные кэшированные файлы после установки пакетов.
Результат: Размер образа значительно уменьшен.

3) В хорошем Dockerfile копируется только один файл, необходимый для запуска приложения — app.py. Сборка становится более чистой и безопасной.
Результат: Меньший размер образа и улучшенная безопасность.


### Плохие практики по работе с контейнерами


